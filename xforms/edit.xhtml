<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:ev="http://www.w3.org/2001/xml-events"
	xmlns:xxforms="http://orbeon.org/oxf/xml/xforms" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:fr="http://orbeon.org/oxf/xml/form-runner" xmlns:mods="http://www.loc.gov/mods/v3"
	xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:etdpub="https://github.com/AmericanNumismaticSociety/etdpub"
	xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:exist="http://exist.sourceforge.net/NS/exist">
	<head>
		<title>ETDPub: Document Editor</title>
		<link rel="stylesheet" href="/fr/style/bootstrap/css/bootstrap.css" type="text/css" />
		<link rel="stylesheet" href="/fr/style/form-runner-bootstrap-override.css" type="text/css" />

		<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" />
		<script type="text/javascript" src="http://netdna.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
		<link rel="shortcut icon" href="/ops/images/orbeon-icon-16.ico" />
		<link rel="icon" href="/ops/images/orbeon-icon-16.png" type="image/png" />
		<link rel="stylesheet" href="/apps/etdpub/xforms/css/style.css" />

		<!-- model -->
		<xforms:model>
			<xforms:instance id="doc" xxforms:exclude-result-prefixes="#all">
				<modsCollection xmlns="http://www.loc.gov/mods/v3" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
					xsi:schemaLocation="http://www.loc.gov/mods/v3      http://www.loc.gov/standards/mods/mods.xsd">
					<mods version="3.6" xmlns="http://www.loc.gov/mods/v3">
						<titleInfo>
							<title></title>
						</titleInfo>
						<name>
							<namePart></namePart>
							<role>
								<roleTerm type="text">Author</roleTerm>
								<roleTerm type="code" authority="marcrelator">aut</roleTerm>
							</role>
						</name>
						<abstract></abstract>
						<genre valueURI=""></genre>
						<typeOfResource>text</typeOfResource>
						<originInfo>
							<dateIssued></dateIssued>
						</originInfo>
						<language>
							<languageTerm>en</languageTerm>
						</language>
						<physicalDescription>
							<internetMediaType></internetMediaType>
						</physicalDescription>
						<location>
							<url></url>
						</location>
						<accessCondition xlink:type="simple" xlink:href="http://creativecommons.org/licenses/by-nc/4.0">Attribution-NonCommercial CC BY-NC</accessCondition>
						<recordInfo>
							<recordContentSource>American Numismatic Society</recordContentSource>
							<recordCreationDate encoding="iso8601"></recordCreationDate>
							<recordIdentifier></recordIdentifier>
						</recordInfo>
					</mods>
				</modsCollection>
			</xforms:instance>

			<!-- configuration and controls -->
			<xforms:instance id="exist-config">
				<xi:include href="../exist-config.xml"></xi:include>
			</xforms:instance>

			<!-- load URLs from config.xml in eXist into form for Solr and CSS file -->
			<xforms:instance id="config">
				<config xmlns=""></config>
			</xforms:instance>

			<xforms:instance id="control-instance" xxforms:exclude-result-prefixes="#all">
				<controls xmlns="">
					<status></status>
					<id></id>
					<media_url></media_url>
					<new>true</new>
					<template></template>
					<template-error>false</template-error>
					<working>false</working>
					<stream_url></stream_url>
					<delete-success>true</delete-success>
				</controls>
			</xforms:instance>

			<!-- MODS templates -->

			<!-- names -->
			<xforms:instance id="affiliation-template" xxforms:exclude-result-prefixes="#all">
				<affiliation xmlns="http://www.loc.gov/mods/v3"></affiliation>
			</xforms:instance>

			<xforms:instance id="role-template" xxforms:exclude-result-prefixes="#all">
				<role xmlns="http://www.loc.gov/mods/v3">
					<roleTerm type="text"></roleTerm>
					<roleTerm type="code" authority="marcrelator"></roleTerm>
				</role>
			</xforms:instance>

			<xforms:instance id="name-template" xxforms:exclude-result-prefixes="#all">
				<name authority="" valueURI="" xmlns="http://www.loc.gov/mods/v3">
					<namePart></namePart>
				</name>
			</xforms:instance>

			<!-- subjects -->
			<xforms:instance id="subject-template" xxforms:exclude-result-prefixes="#all">
				<subject xmlns="http://www.loc.gov/mods/v3"></subject>
			</xforms:instance>

			<xforms:instance id="geographic-template" xxforms:exclude-result-prefixes="#all">
				<geographic authority="" valueURI="" xmlns="http://www.loc.gov/mods/v3"></geographic>
			</xforms:instance>

			<xforms:instance id="temporal-template" xxforms:exclude-result-prefixes="#all">
				<temporal authority="aat" valueURI="" xmlns="http://www.loc.gov/mods/v3"></temporal>
			</xforms:instance>

			<xforms:instance id="topic-template" xxforms:exclude-result-prefixes="#all">
				<topic authority="lcsh" valueURI="" xmlns="http://www.loc.gov/mods/v3"></topic>
			</xforms:instance>


			<!-- originInfo -->
			<xforms:instance id="place-template" xxforms:exclude-result-prefixes="#all">
				<place xmlns="http://www.loc.gov/mods/v3">
					<placeTerm authority="" valueURI=""></placeTerm>
				</place>
			</xforms:instance>

			<xforms:instance id="publisher-template" xxforms:exclude-result-prefixes="#all">
				<publisher xmlns="http://www.loc.gov/mods/v3"></publisher>
			</xforms:instance>

			<xforms:instance id="frequency-template" xxforms:exclude-result-prefixes="#all">
				<frequency valueURI="" authority="marcfrequency" xmlns="http://www.loc.gov/mods/v3"></frequency>
			</xforms:instance>

			<xforms:instance id="issuance-template" xxforms:exclude-result-prefixes="#all">
				<issuance xmlns="http://www.loc.gov/mods/v3"></issuance>
			</xforms:instance>

			<xforms:instance id="date-start-template" xxforms:exclude-result-prefixes="#all">
				<dateIssued point="start" encoding="marc" xmlns="http://www.loc.gov/mods/v3"></dateIssued>
			</xforms:instance>

			<xforms:instance id="date-end-template" xxforms:exclude-result-prefixes="#all">
				<dateIssued point="end" encoding="marc" xmlns="http://www.loc.gov/mods/v3"></dateIssued>
			</xforms:instance>

			<!-- the relatedItem template to link a journal article to a parent journal -->

			<xforms:instance id="host-template" xxforms:exclude-result-prefixes="#all">
				<relatedItem type="host" xmlns="http://www.loc.gov/mods/v3">
					<titleInfo>
						<title></title>
					</titleInfo>
					<identifier></identifier>
					<originInfo>
						<issuance>continuing</issuance>
					</originInfo>
					<part>
						<detail type="volume">
							<number></number>
						</detail>
						<detail type="issue">
							<number></number>
						</detail>
						<extent unit="pages">
							<start></start>
							<end></end>
						</extent>
						<date></date>
					</part>
				</relatedItem>
			</xforms:instance>

			<!-- misc -->
			<xforms:instance id="subTitle-template" xxforms:exclude-result-prefixes="#all">
				<subTitle xmlns="http://www.loc.gov/mods/v3"></subTitle>
			</xforms:instance>

			<!-- list instances -->
			<xforms:instance id="languages">
				<xi:include href="instances/languages.xml"></xi:include>
			</xforms:instance>

			<xforms:instance id="licenses">
				<licenses xmlns="">
					<license value="http://creativecommons.org/licenses/by/4.0">Attribution CC BY</license>
					<license value="http://creativecommons.org/licenses/by-nd/4.0">Attribution-NoDerivs CC BY-ND </license>
					<license value="http://creativecommons.org/licenses/by-nc-sa/4.0">Attribution-NonCommercial-ShareAlike CC BY-NC-SA </license>
					<license value="http://creativecommons.org/licenses/by-sa/4.0">Attribution-ShareAlike CC BY-SA </license>
					<license value="http://creativecommons.org/licenses/by-nc/4.0">Attribution-NonCommercial CC BY-NC</license>
					<license value="http://creativecommons.org/licenses/by-nc-nd/4.0">Attribution-NonCommercial-NoDerivs CC BY-NC-ND </license>
				</licenses>
			</xforms:instance>

			<xforms:instance id="templates">
				<xi:include href="instances/templates.xml"></xi:include>
			</xforms:instance>

			<xforms:instance id="frequencies" xxforms:exclude-result-prefixes="#all">
				<xi:include href="instances/frequencies.xml"></xi:include>
			</xforms:instance>
			
			<xforms:instance id="journals">
				<journals xmlns=""/>
			</xforms:instance>

			<xforms:instance id="content-types">
				<content-types xmlns="">
					<type extension="pdf">application/pdf</type>
				</content-types>
			</xforms:instance>

			<!-- upload instances -->
			<xforms:instance id="file">
				<!-- Start with placeholders for three files -->
				<file xmlns="" xsi:type="xs:anyURI" filename="" mediatype="" size="" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"></file>
			</xforms:instance>

			<xforms:instance id="serializer-config">
				<config xmlns="">
					<url></url>
				</config>
			</xforms:instance>

			<xforms:instance id="generator-config">
				<config xmlns="">
					<url></url>
					<mode>binary</mode>
					<content-type></content-type>
				</config>
			</xforms:instance>

			<xforms:instance id="delete-config">
				<config xmlns="">
					<delete>
						<url></url>
					</delete>
				</config>
			</xforms:instance>

			<xforms:instance id="dump">
				<dump xmlns=""></dump>
			</xforms:instance>

			<!-- Solr instances -->
			<xforms:instance id="addIndex" xxforms:exclude-result-prefixes="#all">
				<add xmlns=""></add>
			</xforms:instance>

			<xforms:instance id="sendCommit" xxforms:exclude-result-prefixes="#all">
				<commit></commit>
			</xforms:instance>

			<!-- XQuery instances -->
			<xforms:instance id="eXist-xquery">
				<exist:query xmlns="">
					<exist:text></exist:text>
				</exist:query>
			</xforms:instance>
			
			<xforms:instance id="xquery-result">
				<exist:result></exist:result>
			</xforms:instance>
			
			<xforms:instance id="xqueries">
				<queries xmlns="">
					<query id="get-journals">
						<![CDATA[declare namespace mods="http://www.loc.gov/mods/v3";						
						 <report> { 
						 	for $record in collection()[descendant::mods:mods/mods:genre/@valueURI='http://vocab.getty.edu/aat/300215390'] let
						 	$title := data($record//mods:mods/mods:titleInfo/mods:title)
						 	order by $title return
						 	<record>
							 		<id>{ data($record//mods:recordIdentifier) }</id>
							 		<title>{ $title }</title>
						 	</record> }						 	
						 </report>]]></query>
				</queries>
			</xforms:instance>
			
			<!-- LOD CRUD instances -->
			<xforms:instance id="rdf" xxforms:exclude-result-prefixes="#all">
				<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"/>
			</xforms:instance>
			
			<xforms:instance id="sparqlUpdate-template">
				<query><![CDATA[PREFIX rdf:	<http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX dcterms:	<http://purl.org/dc/terms/>
DELETE {?s ?p ?o} WHERE { 
{<URI> dcterms:temporal ?s . ?s ?p ?o }
UNION {<URI> ?p ?o . ?s ?p ?o . FILTER (?s = <URI>) }
}]]>
				</query>
			</xforms:instance>
			
			<xforms:instance id="sparqlUpdate">
				<query/>
			</xforms:instance>

			<!-- ************************* BINDINGS ************************** -->
			<xforms:bind nodeset="instance('doc')/mods:mods">
				<xforms:bind nodeset="mods:titleInfo/mods:title" required="true()"></xforms:bind>
				<xforms:bind nodeset="mods:titleInfo/mods:subTitle" required="true()"></xforms:bind>
				<xforms:bind nodeset="mods:name">
					<xforms:bind nodeset="mods:namePart" required="true()"></xforms:bind>
					<xforms:bind nodeset="mods:affiliation" required="true()"></xforms:bind>
					<xforms:bind nodeset="mods:role/mods:roleTerm" required="true()"></xforms:bind>
					<xforms:bind nodeset="mods:nameIdentifier[@type='orcid']" required="true()" constraint="matches(., 'https?://orcid.org/[0-9]{4}-[0-9]{4}-[0-9]{4}-[0-9]{3}[X0-9]{1}')"/>
				</xforms:bind>
				<xforms:bind nodeset="mods:abstract" required="true()"></xforms:bind>
				<xforms:bind nodeset="mods:originInfo">
					<xforms:bind nodeset="mods:dateIssued" required="true()" type="xs:gYear"></xforms:bind>
					<xforms:bind nodeset="mods:publisher" required="true()"></xforms:bind>
					<xforms:bind nodeset="mods:frequency" required="true()">
						<xforms:bind nodeset="@valueURI" required="true()"></xforms:bind>
					</xforms:bind>
					<xforms:bind nodeset="mods:place">
						<xforms:bind nodeset="mods:placeTerm" required="true()">
							<xforms:bind nodeset="@valueURI" constraint="string-length(.) &gt; 0"></xforms:bind>
						</xforms:bind>
					</xforms:bind>
				</xforms:bind>
				<xforms:bind nodeset="mods:location/mods:url" required="true()"></xforms:bind>
				<xforms:bind nodeset="mods:language/mods:languageTerm" required="true()"></xforms:bind>
				<xforms:bind nodeset="mods:recordInfo">
					<xforms:bind nodeset="mods:recordIdentifier" required="true()" constraint="matches(., &quot;^([a-z0-9\-\._&#x0027;]*)?$&quot;)"></xforms:bind>
				</xforms:bind>
				<xforms:bind nodeset="mods:subject">
					<xforms:bind nodeset="*" required="true()">
						<xforms:bind nodeset="@valueURI" constraint="string-length(.) &gt; 0"></xforms:bind>
					</xforms:bind>
				</xforms:bind>
				<xforms:bind nodeset="mods:relatedItem[@type='host']">
					<xforms:bind nodeset="mods:titleInfo/mods:title" required="true()"></xforms:bind>
					<xforms:bind nodeset="mods:identifier" required="true()"></xforms:bind>
					<xforms:bind nodeset="mods:part">
						<xforms:bind nodeset="mods:date" required="true()"></xforms:bind>
						<xforms:bind nodeset="mods:detail/*|mods:extent/*" required="true()"/>
					</xforms:bind>
				</xforms:bind>
			</xforms:bind>

			<xforms:bind nodeset="instance('control-instance')">
				<xforms:bind nodeset="new" type="xs:boolean"></xforms:bind>
				<xforms:bind nodeset="working" type="xs:boolean"></xforms:bind>
				<xforms:bind nodeset="template-error" type="xs:boolean"></xforms:bind>
				<xforms:bind nodeset="delete-success" type="xs:boolean"></xforms:bind>
			</xforms:bind>

			<!-- ************************* SUBMISSIONS ************************** -->
			<!-- *** eXist *** -->
			<xforms:submission id="load-config" serialization="none" method="get" action="{instance('exist-config')/url}etdpub/config.xml" replace="instance" instance="config"
				xxforms:username="{instance('exist-config')/username}" xxforms:password="{instance('exist-config')/password}">
				<xforms:message ev:event="xforms-submit-error" level="modal">Unable to load config file in eXist.</xforms:message>
			</xforms:submission>

			<xforms:submission id="load-doc" serialization="none" method="get" action="{instance('exist-config')/url}etdpub/records/{instance('control-instance')/id}.xml" replace="instance"
				instance="doc" xxforms:username="{instance('exist-config')/username}" xxforms:password="{instance('exist-config')/password}">
				<xforms:message ev:event="xforms-submit-error" level="modal">Unable to load MODS record from eXist.</xforms:message>
				<xforms:action ev:event="xforms-submit-done">
					<xforms:setvalue ref="instance('control-instance')/new" value="false()"></xforms:setvalue>
					<xforms:setvalue ref="instance('control-instance')/template" value="instance('templates')/template[@uri=instance('doc')/mods:mods/mods:genre/@valueURI]/@id"></xforms:setvalue>
				</xforms:action>
			</xforms:submission>

			<xforms:submission id="save-doc" ref="instance('doc')" action="{instance('exist-config')/url}etdpub/records/{instance('doc')/mods:mods/mods:recordInfo/mods:recordIdentifier}.xml"
				method="put" replace="none" xxforms:username="{instance('exist-config')/username}" xxforms:password="{instance('exist-config')/password}">
				<xforms:message ev:event="xforms-submit-error" level="modal">Error Saving Documents. Be sure all required inputs are filled in.</xforms:message>
				<xforms:action ev:event="xforms-submit-done">
					<xforms:setvalue ref="instance('control-instance')/status">Successfully saved MODS record to eXist.</xforms:setvalue>
					<!-- set the new status to false to prevent further editing of the ID -->
					<xforms:setvalue ref="instance('control-instance')/new" value="false()"></xforms:setvalue>
					<!-- set the document URL -->
					<xforms:setvalue ref="instance('control-instance')/stream_url"
						value="if (matches(instance('doc')/mods:mods/mods:location/mods:url, '^https?://')) then instance('doc')/mods:mods/mods:location/mods:url else concat(instance('config')/url, instance('doc')/mods:mods/mods:location/mods:url)"></xforms:setvalue>
					
					<!-- only publish to Solr if it is not a journal -->
					<xforms:send submission="put-document" if="not(instance('control-instance')/template = 'journal')"></xforms:send>
					
					<!-- post to SPARQL endpoint if there is one -->
					<xforms:send submission="get-rdf" if="string(instance('config')/sparql/update) and string(instance('config')/sparql/store)"/>
				</xforms:action>
			</xforms:submission>

			<!-- *** SOLR *** -->
			<xforms:submission id="mods-to-solr" method="get" replace="instance" instance="addIndex" serialization="none"
				resource="/etdpub/id/{instance('doc')/mods:mods/mods:recordInfo/mods:recordIdentifier}.solr">
				<xforms:message ev:event="xforms-submit-error" level="modal">Error transforming MODS record to Solr document.</xforms:message>
				<xforms:send ev:event="xforms-submit-done" submission="post-solr-doc"></xforms:send>
			</xforms:submission>

			<xforms:submission id="post-solr-doc" action="{instance('config')/solr/url}update" ref="instance('addIndex')" instance="addIndex" replace="instance" method="post">
				<xforms:message ev:event="xforms-submit-error" level="modal">Data Failed to POST to Solr. Index may be offline or URL is incorrect.</xforms:message>
				<xforms:action ev:event="xforms-submit-done">
					<xforms:send submission="submit-commit"></xforms:send>
				</xforms:action>
			</xforms:submission>

			<xforms:submission id="put-document" ref="instance('dump')" method="post" replace="none"
				resource="{instance('config')/solr/url}update/extract?literal.id={instance('doc')/mods:mods/mods:recordInfo/mods:recordIdentifier}&amp;stream.url={instance('control-instance')/stream_url}&amp;fmap.content=text&amp;fmap.date=timestamp&amp;commit=true">
				<xforms:header>
					<xforms:name>Content-type</xforms:name>
					<xforms:value ref="instance('doc')/mods:mods/mods:physicalDescription/mods:internetMediaType"></xforms:value>
				</xforms:header>
				<xforms:setvalue ev:event="xforms-submit" ref="instance('control-instance')/working" value="true()"></xforms:setvalue>
				<xforms:message ev:event="xforms-submit-error" level="modal">Unable to index the document file.</xforms:message>
				<xforms:action ev:event="xforms-submit-done">
					<xforms:setvalue ref="instance('control-instance')/status">Document successfully saved to Solr.</xforms:setvalue>
					<xforms:setvalue ref="instance('control-instance')/working" value="false()"></xforms:setvalue>
					<xforms:send submission="mods-to-solr"></xforms:send>
				</xforms:action>
			</xforms:submission>

			<!-- send commit -->
			<xforms:submission id="submit-commit" action="{instance('config')/solr/url}update" ref="instance('sendCommit')" instance="sendCommit" replace="none" method="post">
				<xforms:action ev:event="xforms-submit-error">
					<xforms:message level="modal">Failed to commit to Solr index.</xforms:message>
				</xforms:action>
			</xforms:submission>
			
			<!--***** XQuery *****-->
			<xforms:submission id="xquery-collection" ref="instance('eXist-xquery')" action="{instance('exist-config')/url}etdpub/records" method="post" replace="instance" instance="xquery-result"
				xxforms:username="{instance('exist-config')/username}" xxforms:password="{instance('exist-config')/password}">
				<xforms:message ev:event="xforms-submit-error" level="modal">Error querying eXist database.</xforms:message>
			</xforms:submission>
			
			<!-- ************* SPARQL SUBMISSIONS **********************-->
			<xforms:submission id="get-rdf" serialization="none" method="get" action="/etdpub/id/{instance('control-instance')/id}.rdf" replace="instance"
				instance="rdf">
				<xforms:message ev:event="xforms-submit-error" level="modal">Unable to get RDF/XML serialization.</xforms:message>
				<xforms:action ev:event="xforms-submit-done">
					<xforms:setvalue ref="instance('sparqlUpdate')" value="replace(instance('sparqlUpdate-template'), 'URI', instance('rdf')/*/@rdf:about)"></xforms:setvalue>
					<xforms:send submission="delete-graph"></xforms:send>					
				</xforms:action>
			</xforms:submission>
			
			<xforms:submission id="delete-graph" action="{instance('config')/sparql/update}" ref="instance('sparqlUpdate')" serialization="text/plain" replace="none" method="post"
				mediatype="application/sparql-update">
				<xforms:message level="modal" ev:event="xforms-submit-error">SPARQL update failed.</xforms:message>
				<xforms:send submission="post-rdf" ev:event="xforms-submit-done"/>
			</xforms:submission>
			
			<xforms:submission id="post-rdf" action="{instance('config')/sparql/store}?default" ref="instance('rdf')" replace="none" method="post" mediatype="application/rdf+xml">
				<xforms:setvalue ev:event="xforms-submit-done" ref="instance('control-instance')/status">Successfully posted to endpoint.</xforms:setvalue>
				<xforms:message ev:event="xforms-submit-error" level="modal">Post to endpoint failed.</xforms:message>
			</xforms:submission>

			<!-- **************** XFORMS-MODEL-CONSTRUCT-DONE ********************** -->
			<xforms:action ev:event="xforms-model-construct-done">
				<xforms:send submission="load-config"></xforms:send>

				<!-- set template -->
				<xforms:action if="string(xxforms:get-request-parameter('template'))">
					<xforms:var name="template" select="xxforms:get-request-parameter('template')"></xforms:var>
					<!-- validate template -->
					<xforms:action if="instance('templates')/template[@id=$template]">
						<xforms:setvalue ref="instance('control-instance')/template" value="string(xxforms:get-request-parameter('template'))"></xforms:setvalue>
						<!-- set predetermined values or add elements based on the template -->
						<xforms:setvalue ref="instance('doc')/mods:mods/mods:genre" value="instance('templates')/template[@id=$template]"></xforms:setvalue>
						<xforms:setvalue ref="instance('doc')/mods:mods/mods:genre/@valueURI" value="instance('templates')/template[@id=$template]/@uri"></xforms:setvalue>
						<xforms:setvalue ref="instance('doc')/mods:mods/mods:recordInfo/mods:recordCreationDate" value="format-date(current-date(), '[Y0001]-[M01]-[D01]')"></xforms:setvalue>

						<!-- insert ETD templates -->
						<xforms:insert context="instance('doc')/mods:mods/mods:name" nodeset="./child::node()[last()]" origin="instance('affiliation-template')" if="$template='etd'"></xforms:insert>

						<!-- preconditions for journals -->
						<xforms:action if="$template='journal'">
							<!-- delete physicalDescription and URL -->
							<xforms:delete nodeset="instance('doc')/mods:mods/mods:physicalDescription"></xforms:delete>
							<xforms:delete nodeset="instance('doc')/mods:mods/mods:location"></xforms:delete>

							<xforms:insert context="instance('doc')/mods:mods/mods:originInfo" nodeset="./child::node()[last()]" origin="instance('publisher-template')"></xforms:insert>
							<xforms:insert context="instance('doc')/mods:mods/mods:originInfo" nodeset="./child::node()[last()]" origin="instance('frequency-template')"></xforms:insert>
							<xforms:insert context="instance('doc')/mods:mods/mods:originInfo" nodeset="./child::node()[last()]" origin="instance('issuance-template')"></xforms:insert>
							<xforms:setvalue ref="instance('doc')/mods:mods/mods:originInfo/mods:issuance">serial</xforms:setvalue>
							<xforms:insert context="instance('doc')/mods:mods/mods:originInfo" nodeset="./child::node()[last()]" origin="instance('place-template')"></xforms:insert>
							<!-- remove single dateIssued and replace with range -->
							<xforms:delete nodeset="instance('doc')/mods:mods/mods:originInfo/mods:dateIssued"></xforms:delete>
							<xforms:insert context="instance('doc')/mods:mods/mods:originInfo" nodeset="./child::node()[last()]" origin="instance('date-start-template')"></xforms:insert>
							<xforms:insert context="instance('doc')/mods:mods/mods:originInfo" nodeset="./child::node()[last()]" origin="instance('date-end-template')"></xforms:insert>
						</xforms:action>

						<!-- journal articles -->
						<xforms:action if="$template='article'">
							<!-- handle originInfo changes -->
							<xforms:delete nodeset="instance('doc')/mods:mods/mods:originInfo/mods:dateIssued"></xforms:delete>
							<xforms:insert context="instance('doc')/mods:mods/mods:originInfo" nodeset="./child::node()[last()]" origin="instance('issuance-template')"></xforms:insert>
							<xforms:setvalue ref="instance('doc')/mods:mods/mods:originInfo/mods:issuance">monographic</xforms:setvalue>

							<!-- insert host relatedItem -->
							<xforms:insert context="instance('doc')/mods:mods" nodeset="./child::node()[last()]" origin="instance('host-template')"></xforms:insert>
							
							<!-- execute XQuery to gather list of available journals -->
							<xforms:setvalue ref="instance('eXist-xquery')/exist:text" value="instance('xqueries')/query[@id='get-journals']"></xforms:setvalue>
							<xforms:send submission="xquery-collection"></xforms:send>
							<xforms:action ev:event="xforms-submit-done" xxforms:iterate="instance('xquery-result')//record">
								<xforms:var name="id" select="id"/>
								<xforms:var name="title" select="title"/>
								
								<xforms:insert context="instance('journals')" nodeset="./child::node()[last()]" origin="xforms:element('journal', (xforms:attribute('id', $id), $title))"/>
							</xforms:action>
						</xforms:action>
					</xforms:action>

					<xforms:action if="not(instance('templates')/template[@id=$template])">
						<xforms:setvalue ref="instance('control-instance')/template-error" value="true()"></xforms:setvalue>
					</xforms:action>
				</xforms:action>
				<!-- load id if parameter is passed -->
				<xforms:action if="string(xxforms:get-request-parameter('id'))">
					<xforms:setvalue ref="instance('control-instance')/id" value="xxforms:get-request-parameter('id')"></xforms:setvalue>
					<xforms:send submission="load-doc"></xforms:send>
				</xforms:action>
			</xforms:action>

			<!-- **************** XFORMS-READY ********************** -->
			<xforms:action ev:event="xforms-ready">
				<!-- display template error case if applicable -->
				<xforms:toggle case="template-error" if="instance('control-instance')/template-error = true()"></xforms:toggle>
				<!-- otherwise set the relevant media case -->
				<xforms:action if="instance('control-instance')/template-error = false()">
					<xforms:toggle case="{instance('templates')/template[@id=instance('control-instance')/template]/@case}"></xforms:toggle>
				</xforms:action>
			</xforms:action>
		</xforms:model>

		<!-- XBL includes -->
		<xi:include href="xbl/geographic/geographic.xbl" xi:omit-xml-base="true"></xi:include>
		<xi:include href="xbl/name-creator/name-creator.xbl" xi:omit-xml-base="true"></xi:include>
		<xi:include href="xbl/name-subject/name-subject.xbl" xi:omit-xml-base="true"></xi:include>
		<xi:include href="xbl/place/place.xbl" xi:omit-xml-base="true"></xi:include>
		<xi:include href="xbl/temporal/temporal.xbl" xi:omit-xml-base="true"></xi:include>
		<xi:include href="xbl/topic/topic.xbl" xi:omit-xml-base="true"></xi:include>
	</head>

	<body>
		<xforms:switch>
			<xforms:case id="default">
				<div class="container-fluid">
					<div class="row" id="form">
						<div class="col-md-12">
							<p><a href="../"><span class="glyphicon glyphicon-arrow-left"></span>Return to Admin</a></p>
							<xforms:group ref=".[instance('control-instance')/working=true()]">
								<div class="bg-info alert-box">
									<span class="glyphicon glyphicon-info-sign"></span>
									<strong>Working:</strong> Indexing document...</div>
							</xforms:group>
							<xforms:group ref=".[string-length(instance('control-instance')/status) &gt; 0]">
								<div class="bg-info alert-box">
									<span class="glyphicon glyphicon-info-sign"></span>
									<strong>Status:</strong>
									<xforms:output ref="instance('control-instance')/status"></xforms:output>
								</div>
							</xforms:group>
							<xforms:group ref=".[not(string(instance('doc')/mods:mods/mods:location/mods:url)) and instance('control-instance')/template != 'journal']">
								<div class="bg-danger alert-box">
									<span class="glyphicon glyphicon-exclamation-sign"></span>
									<strong>Alert:</strong> There must be a linked or uploaded document.</div>
							</xforms:group>
							<div class="col-md-6 col-md-offset-3 text-center">
								<xforms:submit submission="save-doc">
									<xforms:label><span class="glyphicon glyphicon-floppy-disk"></span>Save</xforms:label>
								</xforms:submit>
								<xforms:submit submission="load-doc">
									<xforms:label><span class="glyphicon glyphicon-refresh"></span>Load</xforms:label>
								</xforms:submit>
							</div>
						</div>
						<xforms:group ref="instance('doc')/mods:mods">
							<div class="col-md-6">
								<h2>Document Metadata</h2>
								<div class="subsection">
									<div class="text-muted">
										<xforms:output ref="instance('templates')/template[@id=instance('control-instance')/template]/@label">
											<xforms:label>Genre</xforms:label>
										</xforms:output>
									</div>
									<h3>Titles</h3>
									<xforms:group ref=".[count(mods:titleInfo/mods:subTitle) = 0]">
										<xforms:trigger appearance="minimal">
											<xforms:label>
												<span class="glyphicon glyphicon-plus"></span>Subtitle</xforms:label>
											<xforms:insert origin="instance('subTitle-template')" context="mods:titleInfo" nodeset="./child::node()[last()]" ev:event="DOMActivate"></xforms:insert>
										</xforms:trigger>
									</xforms:group>
									<xforms:group ref="mods:titleInfo">
										<div>
											<xforms:input ref="mods:title">
												<xforms:label>Title</xforms:label>
												<xforms:alert>Required</xforms:alert>
												<xforms:action ev:event="xforms-value-changed">
													<xforms:var name="title" select="."></xforms:var>
													<!-- set the id, only if it was previously blank (new file) -->
													<xforms:setvalue ref="instance('doc')/mods:mods/mods:recordInfo/mods:recordIdentifier" value="replace(lower-case($title), '\s', '_')"
														if="not(string(instance('doc')/mods:mods/mods:recordInfo/mods:recordIdentifier))"></xforms:setvalue>
												</xforms:action>
											</xforms:input>
										</div>
										<xforms:group ref="mods:subTitle">
											<div>
												<xforms:input ref=".">
													<xforms:label>Subtitle</xforms:label>
													<xforms:alert>Required</xforms:alert>
												</xforms:input>
												<xforms:trigger appearance="minimal">
													<xforms:delete nodeset="." ev:event="DOMActivate"></xforms:delete>
													<xforms:label>
														<span class="glyphicon glyphicon-remove"></span>
													</xforms:label>
												</xforms:trigger>
											</div>
										</xforms:group>
									</xforms:group>
								</div>
								<div class="subsection">
									<h3>Creators</h3>
									<xforms:trigger appearance="minimal">
										<xforms:label>
											<span class="glyphicon glyphicon-plus"></span>Creator</xforms:label>
										<xforms:action ev:event="DOMActivate">
											<xforms:insert origin="instance('name-template')" context="." nodeset="./child::node()[last()]" position="after"></xforms:insert>
											<xforms:insert origin="instance('role-template')" context="mods:name[last()]" nodeset="./child::node()[last()]"></xforms:insert>
										</xforms:action>
									</xforms:trigger>
									<xforms:repeat nodeset="mods:name">
										<etdpub:name-creator ref="."></etdpub:name-creator>
									</xforms:repeat>
								</div>
								<!-- originInfo -->
								<xforms:group ref=".[not(instance('control-instance')/template = 'article')]">
									<div class="subsection">
										<h3>Publication</h3>
										<!-- only allow the insertion of places for a journal -->
										<xforms:group ref=".[instance('control-instance')/template='journal']">
											<xforms:trigger appearance="minimal">
												<xforms:label>
													<span class="glyphicon glyphicon-plus"></span>Place</xforms:label>
												<xforms:insert origin="instance('place-template')" context="mods:originInfo" nodeset="./child::node()[last()]" ev:event="DOMActivate"></xforms:insert>
											</xforms:trigger>
										</xforms:group>
										<xforms:group ref="mods:originInfo">
											<!-- the default mods:dateIssued for most MODS record types -->
											<xforms:group ref="mods:dateIssued[not(@point)]">
												<div>
													<xforms:input ref=".">
														<xforms:label>Date</xforms:label>
														<xforms:alert>Required. Must be a year.</xforms:alert>
													</xforms:input>
												</div>
											</xforms:group>
											<!-- mods:dateIssued range for journal articles -->
											<xforms:group ref="mods:dateIssued[@point='start']">
												<div>
													<xforms:input ref=".">
														<xforms:label>Start Date</xforms:label>
														<xforms:alert>Required. Must be a year.</xforms:alert>
													</xforms:input>
												</div>
											</xforms:group>
											<xforms:group ref="mods:dateIssued[@point='end']">
												<div>
													<xforms:input ref=".">
														<xforms:label>End Date</xforms:label>
														<xforms:alert>Required. Must be a year.</xforms:alert>
													</xforms:input>
												</div>
											</xforms:group>
											<xforms:group ref="mods:publisher">
												<div>
													<xforms:input ref=".">
														<xforms:label>Publisher</xforms:label>
														<xforms:alert>Required</xforms:alert>
													</xforms:input>
												</div>
											</xforms:group>
											<xforms:group ref="mods:frequency">
												<xforms:select1 ref="@valueURI">
													<xforms:label>Frequency</xforms:label>
													<xforms:alert>Required</xforms:alert>
													<xforms:item>
														<xforms:label>Select...</xforms:label>
														<xforms:value></xforms:value>
													</xforms:item>
													<xforms:itemset nodeset="instance('frequencies')/frequency">
														<xforms:label ref="."></xforms:label>
														<xforms:value ref="@uri"></xforms:value>
													</xforms:itemset>
													<xforms:action ev:event="xforms-value-changed">
														<xforms:var name="uri" select="."></xforms:var>
														<xforms:setvalue ref="instance('doc')/mods:mods/mods:originInfo/mods:frequency" value="instance('frequencies')/frequency[@uri=$uri]"
														></xforms:setvalue>
													</xforms:action>
												</xforms:select1>
											</xforms:group>
											<xforms:repeat nodeset="mods:place">
												<etdpub:place ref="."></etdpub:place>
											</xforms:repeat>
										</xforms:group>
									</div>
								</xforms:group>
								<!-- parent journal data -->
								<xforms:group ref=".[instance('control-instance')/template='article']">
									<xforms:group ref="mods:relatedItem[@type='host']">
										<div class="subsection">
											<h3>Parent Journal</h3>
											<div>
												<xforms:select1 ref="mods:identifier">
													<xforms:label>Journal</xforms:label>
													<xforms:item>
														<xforms:label>Select...</xforms:label>
														<xforms:value></xforms:value>
													</xforms:item>
													<xforms:itemset nodeset="instance('journals')/journal">
														<xforms:label ref="."></xforms:label>
														<xforms:value ref="@id"></xforms:value>
													</xforms:itemset>
													<xforms:alert>Required</xforms:alert>
													<xforms:action ev:event="xforms-value-changed">
														<xforms:var name="id" select="."></xforms:var>
														<xforms:setvalue ref="instance('doc')/mods:mods/mods:relatedItem[@type='host']/mods:titleInfo/mods:title"
															value="instance('journals')/journal[@id=$id]"></xforms:setvalue>
													</xforms:action>
												</xforms:select1>
											</div>
											<xforms:group ref="mods:part">
												<div>
													<xforms:input ref="mods:detail[@type='volume']/mods:number">
														<xforms:label>Volume</xforms:label>
														<xforms:alert>Required</xforms:alert>
													</xforms:input>
												</div>
												<div>
													<xforms:input ref="mods:detail[@type='issue']/mods:number">
														<xforms:label>Issue</xforms:label>
														<xforms:alert>Required</xforms:alert>
													</xforms:input>
												</div>
												<div>
													<xforms:input ref="mods:extent[@unit='pages']/mods:start">
														<xforms:label>Start Page</xforms:label>
														<xforms:alert>Required</xforms:alert>
													</xforms:input>
												</div>
												<div>
													<xforms:input ref="mods:extent[@unit='pages']/mods:end">
														<xforms:label>Start Page</xforms:label>
														<xforms:alert>Required</xforms:alert>
													</xforms:input>
												</div>
												<div>
													<xforms:input ref="mods:date">
														<xforms:label>Date</xforms:label>
														<xforms:alert>Required</xforms:alert>
													</xforms:input>
												</div>
											</xforms:group>
										</div>
									</xforms:group> </xforms:group>
								<div class="subsection">
									<h3>Miscellaneous</h3>
									<div>
										<xforms:select1 ref="mods:language/mods:languageTerm">
											<xforms:label>Language</xforms:label>
											<xforms:item>
												<xforms:label>Select...</xforms:label>
												<xforms:value></xforms:value>
											</xforms:item>
											<xforms:itemset nodeset="instance('languages')/language">
												<xforms:label ref="."></xforms:label>
												<xforms:value ref="@value"></xforms:value>
											</xforms:itemset>
											<xforms:alert>Required</xforms:alert>
										</xforms:select1>
									</div>
									<div>
										<xforms:select1 ref="mods:accessCondition/@xlink:href">
											<xforms:label>Rights</xforms:label>
											<xforms:itemset nodeset="instance('licenses')/license">
												<xforms:label ref="."></xforms:label>
												<xforms:value ref="@value"></xforms:value>
											</xforms:itemset>
											<xforms:action ev:event="xforms-value-changed">
												<xforms:var name="label" select="."></xforms:var>
												<xforms:setvalue ref="instance('doc')/mods:mods/mods:accessCondition" value="$label"></xforms:setvalue>
											</xforms:action>
										</xforms:select1>
									</div>
									<div>
										<xforms:textarea ref="mods:abstract">
											<xforms:label>Abstract</xforms:label>
											<xforms:alert>Required</xforms:alert>
										</xforms:textarea>
									</div>
								</div>
								<div class="subsection">
									<h3>Subject Terms</h3>
									<div class="trigger-container">
										<xforms:trigger appearance="minimal">
											<xforms:label>
												<span class="glyphicon glyphicon-plus"></span>Geographic</xforms:label>
											<xforms:action ev:event="DOMActivate">
												<xforms:insert origin="instance('subject-template')" context="." nodeset="./child::node()[last()]"></xforms:insert>
												<xforms:insert origin="instance('geographic-template')" context="mods:subject[last()]"></xforms:insert>
											</xforms:action>
										</xforms:trigger>
										<xforms:trigger appearance="minimal">
											<xforms:label>
												<span class="glyphicon glyphicon-plus"></span>Name</xforms:label>
											<xforms:action ev:event="DOMActivate">
												<xforms:insert origin="instance('subject-template')" context="." nodeset="./child::node()[last()]"></xforms:insert>
												<xforms:insert origin="instance('name-template')" context="mods:subject[last()]"></xforms:insert>
											</xforms:action>
										</xforms:trigger>
										<xforms:trigger appearance="minimal">
											<xforms:label>
												<span class="glyphicon glyphicon-plus"></span>Temporal</xforms:label>
											<xforms:action ev:event="DOMActivate">
												<xforms:insert origin="instance('subject-template')" context="." nodeset="./child::node()[last()]"></xforms:insert>
												<xforms:insert origin="instance('temporal-template')" context="mods:subject[last()]"></xforms:insert>
											</xforms:action>
										</xforms:trigger>
										<xforms:trigger appearance="minimal">
											<xforms:label>
												<span class="glyphicon glyphicon-plus"></span>Topic</xforms:label>
											<xforms:action ev:event="DOMActivate">
												<xforms:insert origin="instance('subject-template')" context="." nodeset="./child::node()[last()]"></xforms:insert>
												<xforms:insert origin="instance('topic-template')" context="mods:subject[last()]"></xforms:insert>
											</xforms:action>
										</xforms:trigger>
									</div>
									<!-- repeatable elements -->
									<xforms:repeat nodeset="mods:subject[mods:geographic]">
										<etdpub:geographic ref="mods:geographic"></etdpub:geographic>
									</xforms:repeat>
									<xforms:repeat nodeset="mods:subject[mods:name]">
										<etdpub:name-subject ref="mods:name"></etdpub:name-subject>
									</xforms:repeat>
									<xforms:repeat nodeset="mods:subject[mods:temporal]">
										<etdpub:temporal ref="mods:temporal"></etdpub:temporal>
									</xforms:repeat>
									<xforms:repeat nodeset="mods:subject[mods:topic]">
										<etdpub:topic ref="mods:topic"></etdpub:topic>
									</xforms:repeat>
								</div>
							</div>
							<div class="col-md-6">
								<xforms:switch>
									<xforms:case id="doc-upload">
										<xforms:group ref=".[string(mods:location/mods:url)]">
											<div class="subsection">
												<h2>Media <small>
														<xforms:trigger appearance="minimal">
															<xforms:label><span class="glyphicon glyphicon-new-window"></span></xforms:label>
															<xforms:action ev:event="DOMActivate">
																<xforms:setvalue ref="instance('control-instance')/media_url"
																	value="concat(instance('config')/url, instance('doc')/mods:mods/mods:location/mods:url)"></xforms:setvalue>
																<xforms:load ref="instance('control-instance')/media_url"></xforms:load>
															</xforms:action>
														</xforms:trigger>
														<xforms:trigger appearance="minimal">
															<xforms:label><span class="glyphicon glyphicon-remove"></span></xforms:label>
															<xforms:dispatch ev:event="DOMActivate" target="delete-dialog" name="fr-show"></xforms:dispatch>
														</xforms:trigger>
													</small>
												</h2>
												<div>
													<xforms:output ref="mods:location/mods:url">
														<xforms:label>URL</xforms:label>
													</xforms:output>
												</div>
												<div>
													<xforms:output ref="mods:physicalDescription/mods:internetMediaType">
														<xforms:label>Content Type</xforms:label>
													</xforms:output>
												</div>
											</div>
										</xforms:group>
										<xforms:group ref=".[not(string(mods:location/mods:url))]">
											<div class="subsection">
												<h2>Upload Media</h2>
												<xforms:upload ref="instance('file')">
													<xforms:filename ref="@filename"></xforms:filename>
													<xforms:mediatype ref="@mediatype"></xforms:mediatype>
													<xxforms:size ref="@size"></xxforms:size>
												</xforms:upload>
												<br />
												<xforms:trigger>
													<xforms:label>Upload</xforms:label>
													<xforms:action ev:event="DOMActivate">
														<xforms:send submission="upload-file"></xforms:send>
														<!--get the temp file written to disk, and move it into the docs folder in the etdpub app directory -->
														<xforms:action ev:event="xforms-submit-done">
															<xforms:setvalue ref="instance('generator-config')/url" value="instance('file')"></xforms:setvalue>
															<xforms:setvalue ref="instance('generator-config')/content-type" value="instance('file')/@mediatype"></xforms:setvalue>
															<xforms:setvalue ref="instance('serializer-config')/url"
																value="concat('oxf:/apps/etdpub/docs/', replace(instance('file')/@filename, ' ', '_'))"></xforms:setvalue>
															<xforms:insert nodeset="instance('dump')"
																origin="xxforms:call-xpl('oxf:/apps/etdpub/xpl/xforms/move-file.xpl', ('generator-config', 'serializer-config'), (instance('generator-config'), instance('serializer-config')), 'data')"></xforms:insert>
															<!-- set the data within the MODS document -->
															<xforms:setvalue ref="instance('doc')/mods:mods/mods:location/mods:url"
																value="concat('docs/', replace(instance('file')/@filename, ' ', '_'))"></xforms:setvalue>
															<xforms:setvalue ref="instance('doc')/mods:mods/mods:physicalDescription/mods:internetMediaType" value="instance('file')/@mediatype"
															></xforms:setvalue>
														</xforms:action>
													</xforms:action>
												</xforms:trigger>
											</div>
										</xforms:group>
									</xforms:case>
									<xforms:case id="manual-link">
										<h2>Link Media</h2>
										<div>
											<!--<xforms:input ref="instance('control-instance')/media_url">
												<xforms:label>URL</xforms:label>												
											</xforms:input>
											<xforms:trigger>
												<xforms:label>Validate</xforms:label>
												<xforms:action ev:event="DOMActivate">
													<xforms:setvalue ref="instance('doc')/mods:mods/mods:physicalDescription/mods:internetMediaType" value="xxforms:get-request-header('User-Agent')"/>
												</xforms:action>
											</xforms:trigger>-->
											<xforms:input ref="mods:location/mods:url">
												<xforms:label>URL</xforms:label>
												<xforms:action ev:event="xforms-value-changed">
													<xforms:var name="extension" select="tokenize(., '\.')[last()]"></xforms:var>
													<xforms:setvalue ref="instance('doc')/mods:mods/mods:physicalDescription/mods:internetMediaType"
														value="instance('content-types')/type[@extension=$extension]"></xforms:setvalue>
												</xforms:action>
											</xforms:input>
										</div>
										<div>
											<xforms:output ref="mods:physicalDescription/mods:internetMediaType">
												<xforms:label>Content Type</xforms:label>
											</xforms:output>
										</div>
									</xforms:case>
									<xforms:case id="no-upload"></xforms:case>
								</xforms:switch>
								<xforms:group ref="mods:recordInfo">
									<div class="subsection">
										<h2>Record Info</h2>
										<xforms:group ref=".[instance('control-instance')/new = true()]">
											<div>
												<xforms:input ref="mods:recordIdentifier">
													<xforms:label>ID</xforms:label>
													<xforms:alert>Required</xforms:alert>
												</xforms:input>
											</div>
										</xforms:group>
										<xforms:group ref=".[instance('control-instance')/new = false()]">
											<div>
												<xforms:output ref="mods:recordIdentifier">
													<xforms:label>ID</xforms:label>
													<xforms:alert>The ID must be valid.</xforms:alert>
												</xforms:output>
											</div>
										</xforms:group>
										<div>
											<xforms:output ref="mods:recordCreationDate">
												<xforms:label>Creation Date</xforms:label>
											</xforms:output>
										</div>
									</div>
								</xforms:group>
							</div>
						</xforms:group>
					</div>
				</div>
			</xforms:case>
			<xforms:case id="template-error">
				<div class="container-fluid">
					<div class="row">
						<div class="col-md-12">
							<h1>Template error</h1>
							<p><a href="../"><span class="glyphicon glyphicon-arrow-left"></span>Return to Admin</a></p>
							<div class="bg-danger alert-box">
								<span class="glyphicon glyphicon-exclamation-sign"></span>
								<strong>Alert:</strong> The template ID is invalid.</div>
						</div>
					</div>
				</div>
			</xforms:case>
		</xforms:switch>

		<fr:alert-dialog id="delete-dialog">
			<fr:label>Delete Document</fr:label>
			<fr:message>Are you sure you want to delete the document file?</fr:message>
			<fr:positive-choice>
				<fr:label>Yes</fr:label>
				<xforms:action ev:event="DOMActivate">
					<!-- delete the file -->
					<xforms:setvalue ref="instance('delete-config')/delete/url" value="concat('oxf:/apps/etdpub/', instance('doc')/mods:mods/mods:location/mods:url)"></xforms:setvalue>
					<xforms:insert nodeset="instance('dump')" origin="xxforms:call-xpl('oxf:/apps/etdpub/xpl/xforms/delete-document.xpl', 'configuration', instance('delete-config'), 'data')"></xforms:insert>
					<!-- blank the URL and mime type -->
					<xforms:setvalue ref="instance('doc')/mods:mods/mods:location/mods:url"></xforms:setvalue>
					<xforms:setvalue ref="instance('doc')/mods:mods/mods:physicalDescription/mods:internetMediaType"></xforms:setvalue>
				</xforms:action>
			</fr:positive-choice>
			<fr:negative-choice>
				<fr:label>No</fr:label>
			</fr:negative-choice>
		</fr:alert-dialog>

		<!--<fr:xforms-inspector></fr:xforms-inspector>-->
	</body>
</html>
